THIS CODE IS IN C++ AND IS NOT COMPATIBLE WITH THREADX
